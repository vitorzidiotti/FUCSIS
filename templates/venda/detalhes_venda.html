{% extends "base.html" %}
{% block title %}Detalhes da Venda #{{ venda.id_venda }}{% endblock %}

{% block content %}
<h1>Detalhes da Venda #{{ venda.id_venda }}</h1>

<div class="auth-container" style="max-width: 900px; margin-top: 1rem;">
    
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-bottom: 1.5rem;">
        <div>
            <label style="font-weight: 600;">Cliente:</label>
            <p style="margin: 0; font-size: 1.1em;">
                {{ venda.cliente.nome or 'Cliente Removido' }}
            </p>
        </div>
        <div>
            <label style="font-weight: 600;">Vendedor:</label>
            <p style="margin: 0; font-size: 1.1em;">
                {{ venda.vendedor.nome or 'Vendedor Removido' }}
            </p>
        </div>
        <div>
            <label style="font-weight: 600;">Data da Venda:</label>
            <p style="margin: 0; font-size: 1.1em;">{{ venda.data_venda.split('T')[0] }}</p>
        </div>
        <div>
            <label style="font-weight: 600;">Valor Total:</label>
            <p style="margin: 0; font-size: 1.2em; font-weight: 700; color: #28a745;">
                R$ {{ "%.2f"|format(venda.total)|replace('.', ',') }}
            </p>
        </div>
    </div>
    
    <hr style="border: none; border-top: 1px solid #eee; margin-bottom: 1.5rem;">

    <h2>Itens Vendidos (O que foi tirado)</h2>
    <div class="table-container">
        <table>
            <thead>
                <tr>
                    <th>Produto</th>
                    <th>Marca</th>
                    <th class="text-center">Qtd. Vendida</th>
                    <th class="text-center">Preço Unit.</th>
                    <th class="text-center">Subtotal</th>
                </tr>
            </thead>
            <tbody>
                {% if itens %}
                    {% for item in itens %}
                    <tr>
                        <td data-label="Produto">{{ item.tb_produto.nome or 'Produto Removido' }}</td>
                        <td data-label="Marca">{{ item.tb_produto.marca or '-' }}</td>
                        <td data-label="Qtd. Vendida" class="text-center">{{ item.quantidade }}</td>
                        
                        <td data-label="Preço Unit." class="text-center">
                            R$ {{ "%.2f"|format(item.preco_unitario)|replace('.', ',') }}
                        </td>
                        
                        {% set subtotal = item.quantidade * item.preco_unitario %}
                        <td data-label="Subtotal" class="text-center" style="font-weight: 600;">
                            R$ {{ "%.2f"|format(subtotal)|replace('.', ',') }}
                        </td>
                    </tr>
                    {% endfor %}
                {% else %}
                <tr>
                    <td colspan="5" class="no-results">Nenhum item encontrado para esta venda.</td>
                </tr>
                {% endif %}
            </tbody>
        </table>
    </div>
    
    <div class="modal-actions" style="margin-top: 1.5rem; justify-content: center;">
         <a href="{{ url_for('venda.gerenciar_vendas') }}" class="btn btn-yellow">
            Voltar para Vendas
         </a>
    </div>

</div>
{% endblock %}