{% extends "base.html" %}

{% block title %}Editar Usuário{% endblock %}

{% block content %}
    <div class="auth-container" style="margin-top: 2rem;">
        <h1>Editar Usuário</h1>
        
        <form method="POST" action="{{ url_for('usuario.editar_usuario', id_usuario=usuario.id_usuario) }}">
            <label for="nome">Nome Completo:</label>
            <input type="text" id="nome" name="nome" value="{{ usuario.nome }}" required>

            <label for="email">Email:</label>
            <input type="email" id="email" name="email" value="{{ usuario.email }}" required>

            <label for="cpf">CPF:</label>
                        <input type="text" id="cpf" name="cpf" value="{{ usuario.cpf }}" required maxlength="14">
            
            <label for="senha">Nova Senha (deixe em branco para não alterar):</label>
            <input type="password" id="senha" name="senha">

            <div style="display: flex; align-items: center; gap: 10px; margin-top: 1rem;">
                <input type="checkbox" id="is_admin" name="is_admin" style="width: auto;" {% if usuario.is_admin %}checked{% endif %}>
                <label for="is_admin" style="margin: 0;">Este usuário é um administrador?</label>
            </div>
            <button type="submit" class="btn btn-green" style="width: 100%; padding: 14px; margin-top: 1rem;">Salvar Alterações</button>
            <a href="{{ url_for('usuario.gerenciar_usuarios') }}" class="btn btn-yellow" style="width: 100%; padding: 14px;">Cancelar</a>
        </form>
    </div>

<script>
document.addEventListener("DOMContentLoaded", function() {
    const cpfInput = document.getElementById("cpf");

    // Função que formata um valor de CPF
    function formatarCPF(cpf) {
        let value = String(cpf).replace(/\D/g, ""); // Garante que é string e limpa
        value = value.substring(0, 11);
        let maskedValue = "";

        if (value.length > 9) {
            maskedValue = value.replace(/(\d{3})(\d{3})(\d{3})(\d{2})/, "$1.$2.$3-$4");
        } else if (value.length > 6) {
            maskedValue = value.replace(/(\d{3})(\d{3})(\d{1,3})/, "$1.$2.$3");
        } else if (value.length > 3) {
            maskedValue = value.replace(/(\d{3})(\d{1,3})/, "$1.$2");
        } else {
            maskedValue = value;
        }
        return maskedValue;
    }

    // Função de evento para o 'input'
    function aplicarMascaraCPF(e) {
        e.target.value = formatarCPF(e.target.value);
    }

    if (cpfInput) {
        // 1. Formata o valor inicial que vem do banco (para a tela de Editar)
        cpfInput.value = formatarCPF(cpfInput.value);

        // 2. Adiciona o listener para formatar enquanto digita
        cpfInput.addEventListener("input", aplicarMascaraCPF);
    }
});
</script>
{% endblock %}